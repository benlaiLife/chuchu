function viewSkuChoose(t,s,e,i,l){function a(){for(var t=0;t<$(".selectUl").find("li").length;t++){var s=!0;if($(".selectUl").find("li").eq(t).hasClass("selectstr"))s=!1;else{for(var e=$(".selectUl").find("li").eq(t).attr("data-id"),i=$(".selectUl").find("li").eq(t).attr("data-pid"),l=[],a=!1,r=0;r<o.length;r++)if(o[r].attrs[i]==e){var c=!0;for(var d in h)h[d]!=o[r].attrs[d]&&d!=i&&(c=!1);c&&(l.push(o[r]),$(".tc_count").hide())}for(var n=0;n<l.length;n++)0!=l[n].stock&&(a=!0);a&&(s=!1)}s?$(".selectUl").find("li").eq(t).addClass("nocolor"):$(".selectUl").find("li").eq(t).removeClass("nocolor")}}function r(){for(var t=0;t<o.length;t++){var s=!0;for(var e in h)h[e]!=o[t].attrs[e]&&(s=!1);s&&(l=o[t].buy_limit,$(".tc_count").html('<em class="ftA pr5">该商品限购<span id="skuStock" data-stock="'+o[t].stock+'">'+l+"</span>件</em>").show())}}function c(){$(".sku_submit").removeClass("bgCCC").addClass("bgred"),$(".sku_submit").bind("click",function(){for(var t,l=0;l<o.length;l++){var a=!0;for(var r in h)h[r]!=o[l].attrs[r]&&(a=!1);a&&(t=o[l].sku_id)}if(i){for(var c="",d=0;d<$(".skuST").length;d++)c+=d!=$(".skuST").length?$(".skuST .selectTitle").eq(d).text()+":"+$(".selectUl .selectstr").eq(d).text()+",":$(".skuST .selectTitle").eq(d).text()+":"+$(".selectUl .selectstr").eq(d).text();var n=[{count:$(".sku_count").text(),currentPrice:s.sales_price_real,product_id:s.product_id,sku_id:t,sku_value:c,version:"",statics_id:"37"}];e(n)}else{var n={skuId:t,id:s.product_id,num:$(".sku_count").text()};e(n)}})}var d=s.attr_keys,n=s.attr_keys.length,o=s.sku_array,u=[],f="",v="",h={},p={},_="1"===s.is_oversea_product?1:0;t.removeClass("Ndisplay"),oldHeight=$("body").height(),$("html").css({height:$(window).height(),overflow:"hidden"}),$("body").css({height:$(window).height(),overflow:"hidden"});for(var k=0,b=o.length;b>k;k++)0!=u.length?-1===u.indexOf(o[k].price)&&u.push(o[k].price):u.push(o[k].price);u.sort(function(t,s){return t-s}),t.empty();s.sku_array.length;t.append($('<div class="layer"></div>'));var g=$('<div class="layer_box" id="layer_box"><div class="p_shop_close"></div></div>');v=1==u.length?'<span class="ftred ft1">￥'+u[0]+"</span>":'<em class="ft1 ftred" id="priceTxt">￥'+u[0]+"~￥"+u[u.length-1]+"</em>";var m=$('<div class="box_one pt10 border_bt_e"><div class="big_shop bgFFF clearfix"><img src="'+s.image_urls_head[0]+'" class="tc_shopimg sku_img" alt=""/><p class="ft6 ft09 lh18">'+s.title+"</p>"+v+'<span class="tc_count ft08"><em class="ftA pr5">库存<span id="skuStock">'+s.stocks+"</span>件</em>"+f+"</span></div></div>");g.append(m);for(var x=$('<div class="p_bg bgFFF"></div>'),k=0;n>k;k++){for(var C=d[k].attr_values,y=$('<div class="p_color skuST"><h1 class="ft1 ft4">选择<span class="selectTitle">'+d[k].name+"</span></h1></div>"),q=$('<ul class="p_color_check ft1 border_bt_e selectUl clearfix classification'+k+'"></ul>'),S=0;S<C.length;S++){var w=$('<li data-id="'+C[S].id+'" data-pId="'+d[k].id+'">'+C[S].name+"</li>");q.append(w)}x.append(y),x.append(q)}var U=$('<div class="p_count clearfix"><h1 class="ft1 ft4 mb5 lh30">数量</h1><div class="clearfix"><div class="p_num"><div class="num_btn reduce_nmu">-</div><div class="btn_txt"><label class="sku_count">1</label></div><div class="num_btn add_nmu">+</div></div></div><p class="ftred ft08 Ndisplay">*已超出限购数量</p></div>');x.append(U),g.append(x);var T=$('<div class="btn ft1 clearfix"><a href="#" class="sku_submit bgCCC">确定</a></div>');g.append(T),t.append(g);for(var k=0;k<$(".selectUl").length;k++)1==$(".selectUl").eq(k).find("li").length&&($(".selectUl").eq(k).find("li").addClass("selectstr"),h[$(".selectUl").eq(k).find("li").attr("data-pid")]=$(".selectUl").eq(k).find("li").attr("data-id"));n-$(".selectstr").length==0&&(c(),_&&r()),a();for(var F=0,H=0,N=$("#priceTxt").text(),A=$("#skuStock").text(),k=0;n>k;k++)$(".classification"+k).find("li").bind("click",function(){if($(this).hasClass("nocolor"))return!1;if($(this).hasClass("selectstr"))$("#priceTxt").text(N),$("#skuStock").text(A),delete h[$(this).attr("data-pid")],$(this).removeClass("selectstr"),$(".sku_submit").unbind("click"),$(".sku_submit").removeClass("bgred").addClass("bgCCC"),a();else if(h[$(this).attr("data-pid")]=$(this).attr("data-id"),$(this).parent().children().removeClass("selectstr"),$(this).addClass("selectstr"),n-$(".selectstr").length>0)$(".sku_submit").unbind("click"),$(".sku_submit").removeClass("bgred").addClass("bgCCC"),a();else{a();for(var t=0;t<$(".selectstr").length;t++)p[$(".selectstr").eq(t).attr("data-pid")]=$(".selectstr").eq(t).attr("data-id");for(var s=0;s<o.length;s++){var e=!0;for(var i in p)p[i]!=o[s].attrs[i]&&(e=!1);if(e){F=o[s].price,H=o[s].stock;var l=$(".sku_count").text()-0,d=o[s].buy_limit-0;_&&l>=d&&$(".sku_count").text(d)}}$("#priceTxt").text("￥"+F),$("#skuStock").text(H),c(),_&&r()}});$("#layer_box .p_shop_close").unbind().bind("click",function(){t.addClass("Ndisplay"),$("html").css({height:oldHeight,overflow:"visible"}),$("body").css({height:oldHeight,overflow:"visible"})}),t.find(".layer").unbind().bind("click",function(){t.addClass("Ndisplay"),$("html").css({height:oldHeight,overflow:"visible"}),$("body").css({height:oldHeight,overflow:"visible"})});var I=$(".sku_count").text()-0||1;$("#layer_box .reduce_nmu").bind("click",function(){I=$(".sku_count").text()-0||1,I--,1>I&&(I=1),$("#layer_box .sku_count").text(I)}),$("#layer_box .add_nmu").bind("click",function(){if(I=$(".sku_count").text()-0||1,I++,-1!=l){if(I>$("#skuStock").attr("data-stock"))return I=$("#skuStock").attr("data-stock"),alertify("库存不足"+I+"个"),!1;if(I>l)return I=l,alertify("该商品限购"+l+"个"),!1}return I>$("#skuStock").text()?(I=$("#skuStock").text(),alertify("库存不足"),!1):void $("#layer_box .sku_count").text(I)})}function alertify(t){var s=$(".warm");s.text(t).show(),setTimeout(function(){s.text("").hide()},2500)}